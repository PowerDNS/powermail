<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>PowerMail introduction</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.76b+
"><LINK
REL="HOME"
TITLE="PowerMail manual"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="PowerMail manual"
HREF="index.html"><LINK
REL="NEXT"
TITLE="What PowerMail is not, roadmap"
HREF="roadmap.html"></HEAD
><BODY
CLASS="CHAPTER"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PowerMail manual</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="index.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="roadmap.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="CHAPTER"
><H1
><A
NAME="AEN12">Chapter 1. PowerMail introduction</H1
><P
>      PowerMail is a redundant &amp; distributed system for receiving mail and
      storing it for users. The way PowerMail works is quite unorthodox, this
      document sets out how the different modules cooperate.
    </P
><P
>      PowerMail only receives email and makes it available over POP. Furthermore, incoming email
      can be forwarded to other email addresses. Although most PowerMail installations will query
      a relational database for information about email addresses, messages are stored on disk.
    </P
><P
>      The real strength of PowerMail lies in:
      <P
></P
><UL
><LI
><P
>	    One single source of information about mailboxes. No /etc/passwd, no 'recipientdomains', or whatever.
	    If a mailbox is listed in the userbase, it works.
	  </P
></LI
><LI
><P
>	    Ability to scale. Distributed message hosting means that additional machines can be added on the fly without
	    moving files around or growing filesystems.
	  </P
></LI
><LI
><P
>	    Redundancy. Besides distributing messages over multiple machines, additional copies can be stored, leading to 
	    very high redundancy. Furthermore, it is easily possible to have multiple pop servers online at once, as well
	    as multiple smtp servers, all talking to the same pool of messages. There is no single point of failure. And no NFS either.
	  </P
></LI
><LI
><P
>	    Very high performance. PowerMail is about receving email. There is no queue, email is never bounced. Either
	    email is accepted or it is not - there is no way for the system to get jammed with incoming email. Messages
	    are sent straight to the disk. Retrieval works the same way, in reverse. On operating systems supporting this,
	    <TT
CLASS="FUNCTION"
>sendfile()</TT
> zerocopy TCP features are exploited for maximum throughput.
	  </P
></LI
></UL
>
    </P
><P
>      It is best to not compare PowerMail to traditional mailhosting solutions as this can be very confusing.
      Specifically:
      <P
></P
><UL
><LI
><P
>	    There is no mapping between mailboxes and UNIX users. All user data is always read from the 
	    User Base, which is typically a relational database
	  </P
></LI
><LI
><P
>	  Mailbox centric and not domain centric. A mailbox exists or it doesn't. There is no reason to configure
	  which domains PowerMail is to host mailboxes for.
	  </P
></LI
><LI
><P
>	    SMTP and POP daemons can be on different machines than the messages. PowerSMTP and PowerPOP do not access
	    the disk directly - they contact the backends for that purpose.
	  </P
></LI
><LI
><P
>	    Messages can live on multiple machines simultaneously and redundantly. 
	    A mailbox may span multiple machines.
	  </P
></LI
></UL
>
    </P
><P
>      PowerMail can best be thought of as mail hosting where adding a new mailbox consists of a single SQL insert statement.
    </P
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="CONCEPTS">1.1. Concepts</H1
><P
>      The following concepts are used by PowerMail, followed by their specific meaning within PowerMail:
    </P
><P
>      <P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Mailboxes</DT
><DD
><P
>	      PowerMail contains an arbitrary number of Mailboxes. Contrary to existing
	      practice, a mailbox name includes the domain name. A sample mailbox might be
	      called 'info@company.biz'. PowerMail does not care which domain a mailbox
	      resides under - the mailbox name includes the domain.
	    </P
></DD
><DT
>Userbase</DT
><DD
><P
>	      To know if a mailbox exists, the Userbase is queried. This will most often
	      be a relational database. The stock PowerMail distribution works with MySQL.
	      Besides storing which mailboxes exist, the Userbase also knows about Quotas
	      and Mailforwarding.
	    </P
></DD
><DT
>Messages</DT
><DD
><P
>	      A mailbox consists of messages. Each message is a single file on disk, even
	      if it has multiple recipients. In other words, a single file can live in
	      multiple mailboxes simultaneously. This means that a message with thousands
	      of recipients is stored only once on disk.
	    </P
></DD
><DT
>Backends</DT
><DD
><P
>	      The mentioned messages live on backends. Each backend is a very
	      simpleminded fileserver. Typically, a single backend is used per host,
	      unless that host has multiple filesystems, in which case a backend is
	      started for each filesystem. Backends can be additively configured. A backend 
	      is accessed via the <B
CLASS="COMMAND"
>pplistener</B
> command.
	    </P
><P
>	      Backends store messages as files on disk. Each message is one file.
	    </P
></DD
><DT
>Redundancy &amp; Distributed Hosting</DT
><DD
><P
>	      Each message may live on multiple backends. This can be used both for redundancy as well as for bandwidth purposes. It is possible
	      to assign storage backends to specific locations and make sure that POP traffic thus remains local.
	    </P
></DD
><DT
>Daemons</DT
><DD
><P
>	      Mail is received over the Simple Mail Tranport Protocol, SMTP. It is
	      transferred to the reader via the Post Office Protocol, version 3, POP3.
	    </P
></DD
><DT
>The powersmtp daemon</DT
><DD
><P
>	      The powersmtp daemon listens on the SMTP port (25) and checks with the
	      Userbase if recipients exist. If they do, the message is received and sent
	      to a backend. The recipient might also be a forwarded account, in which case
	      the message is passed to the outgoing SMTP host. 
	    </P
></DD
><DT
>The powerpop daemon</DT
><DD
><P
>	      The powerpop daemon listens on the pop3 port (110) and checks with the
	      Userbase if the supplied user and password data exist in the database. If
	      this is the case, all messages for this mailbox are retrieved from the
	      backends.

	      Duplicates are filtered out and the unified list is presented to the user.
	    </P
></DD
><DT
>The pplistener daemon</DT
><DD
><P
>	      Each backend runs the pplistener daemon which can be likened to a very
	      simple ftp server. Each pplistener can be in read/write or in readonly mode.
	      The latter might for example occur if the filesystem is full, or if the
	      backend is about to be phased out and should accept no new data.
	    </P
></DD
></DL
></DIV
>
    </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="roadmap.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>PowerMail manual</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>What PowerMail is not, roadmap</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>